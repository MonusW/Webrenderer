"use strict";var Color=function(){function Color(r,g,b){this.r=0;this.g=0;this.b=0;if(g===undefined&&b===undefined){this.set(r)}else{this.setRGB(r,g,b)}}Color.prototype.setRGB=function(r,g,b){this.r=r;this.g=g;this.b=b};Color.prototype.set=function(value){if(typeof value==="number"){this.setHex(value)}};Color.prototype.setHex=function(hex){hex=Math.floor(hex);this.r=hex>>16&255;this.g=hex>>8&255;this.b=hex&255};Color.prototype.interp=function(c,t){var iR=Math.round(interp(this.r,c.r,t));var iG=Math.round(interp(this.g,c.g,t));var iB=Math.round(interp(this.b,c.b,t));return new Color(iR,iG,iB)};Color.prototype.clone=function(){return new Color(this.r,this.g,this.b)};Color.prototype.swap=function(c){var tmp=c.clone();c.r=this.r;c.g=this.g;c.b=this.b;this.r=tmp.r;this.g=tmp.g;this.b=tmp.b};return Color}();"use strict";var Vertex=function(){function Vertex(x,y,z,color){if(x===void 0){x=0}if(y===void 0){y=0}if(z===void 0){z=0}this.position=new Vec3(x,y,z);if(color===undefined){this.color=new Color(0)}else{this.color=color}}Vertex.prototype.interp=function(v,t){var position=this.position.interp(v.position,t);var color=this.color.interp(v.color,t);return new Vertex(position.x,position.y,position.z,color)};Vertex.prototype.swap=function(v){this.position.swap(v.position);this.color.swap(v.color)};return Vertex}();function sortTriangleVertex(v1,v2,v3){if(v1.position.y>v2.position.y||v1.position.y==v2.position.y&&v1.position.x>v2.position.x){v1.swap(v2)}if(v2.position.y>v3.position.y||v2.position.y==v3.position.y&&v2.position.x>v3.position.x){v2.swap(v3)}if(v1.position.y>v2.position.y||v1.position.y==v2.position.y&&v1.position.x>v2.position.x){v1.swap(v2)}}"use strict";var WebRenderer=function(){function WebRenderer(_canvas,width,height){_canvas.width=width;_canvas.height=height;this.ctx=_canvas.getContext("2d");this.bufferData=this.ctx.createImageData(width,height);this.width=width;this.height=height;this.clearBuffer()}WebRenderer.prototype.clearBuffer=function(){var index=0;var data=this.bufferData.data;for(var h=0;h<this.height;h++){for(var w=0;w<this.width;w++){index=(h*this.width+w)*4;data[index]=0;data[index+1]=0;data[index+2]=0;data[index+3]=255}}};WebRenderer.prototype.render=function(){this.ctx.putImageData(this.bufferData,0,0)};WebRenderer.prototype.drawPixel=function(x,y,color,alpha){if(alpha===void 0){alpha=1}if(x>this.width||y>this.height||x<0||y<0){return}x=Math.round(x);y=Math.round(y);var index=(y*this.width+x)*4;var data=this.bufferData.data;data[index]=color.r;data[index+1]=color.g;data[index+2]=color.b;data[index+3]=255*alpha};WebRenderer.prototype.drawLine=function(v1,v2){var x1=v1.position.x;var y1=v1.position.y;var x2=v2.position.x;var y2=v2.position.y;var dx=Math.abs(x2-x1);var dy=Math.abs(y2-y1);if(dx>=dy){if(x1>x2){var tmp=x1;x1=x2;x2=tmp;tmp=y1;y1=y2;y2=tmp;v1.color.swap(v2.color)}var flag=y2>=y1?1:-1;var k=flag*(dy<<1);var e=-dx*flag;for(var x=x1,y=y1;x<=x2;x++){var t=(x-x1)/(x2-x1);var color=v1.color.interp(v2.color,t);this.drawPixel(x,y,color);e+=k;if(flag*e>0){y+=flag;e-=2*dx*flag}}}else{if(y1>y2){var tmp=x1;x1=x2;x2=tmp;tmp=y1;y1=y2;y2=tmp;v1.color.swap(v2.color)}var flag=x2>x1?1:-1;var k=flag*(dx<<1);var e=-dy*flag;for(var x=x1,y=y1;y<=y2;y++){var t=(y-y1)/(y2-y1);var color=v1.color.interp(v2.color,t);this.drawPixel(x,y,color);e+=k;if(flag*e>0){x+=flag;e-=2*dy*flag}}}};WebRenderer.prototype.drawTriangle=function(v1,v2,v3){sortTriangleVertex(v1,v2,v3);if(Math.round(v1.position.y)==Math.round(v2.position.y)){this.drawBottomFlatTriangle(v1,v2,v3)}else if(Math.round(v2.position.y)==Math.round(v3.position.y)){this.drawTopFlatTriangle(v1,v2,v3)}else{var t=(v2.position.y-v1.position.y)/(v3.position.y-v1.position.y);var v4=v1.interp(v3,t);if(v4.position.x<v2.position.x){v2.swap(v4)}this.drawBottomFlatTriangle(v2,v4,v3);this.drawTopFlatTriangle(v1,v2,v4)}};WebRenderer.prototype.drawBottomFlatTriangle=function(v1,v2,v3){var startY=v1.position.y;var endY=v3.position.y;for(var y=startY;y<=endY;y++){var t=(y-startY)/(endY-startY);var vl=v1.interp(v3,t);var vr=v2.interp(v3,t);this.drawScanLine(vl,vr)}};WebRenderer.prototype.drawTopFlatTriangle=function(v1,v2,v3){var startY=v1.position.y;var endY=v3.position.y;for(var y=startY;y<=endY;y++){var t=(y-startY)/(endY-startY);var vl=v1.interp(v2,t);var vr=v1.interp(v3,t);this.drawScanLine(vl,vr)}};WebRenderer.prototype.drawScanLine=function(v1,v2){var x=Math.round(v1.position.x);var y=Math.round(v1.position.y);var length=Math.round(v2.position.x)-x;for(var i=0;i<=length;i++){var t=i/length;var color=v1.color.interp(v2.color,t);this.drawPixel(x+i,y,color)}};return WebRenderer}();"use strict";var Matrix4=function(){function Matrix4(_n11,_n12,_n13,_n14,_n21,_n22,_n23,_n24,_n31,_n32,_n33,_n34,_n41,_n42,_n43,_n44){if(_n11===void 0){_n11=1}if(_n12===void 0){_n12=0}if(_n13===void 0){_n13=0}if(_n14===void 0){_n14=0}if(_n21===void 0){_n21=0}if(_n22===void 0){_n22=1}if(_n23===void 0){_n23=0}if(_n24===void 0){_n24=0}if(_n31===void 0){_n31=0}if(_n32===void 0){_n32=0}if(_n33===void 0){_n33=1}if(_n34===void 0){_n34=0}if(_n41===void 0){_n41=0}if(_n42===void 0){_n42=0}if(_n43===void 0){_n43=0}if(_n44===void 0){_n44=1}this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];this.elements[0]=_n11,this.elements[1]=_n12,this.elements[2]=_n13,this.elements[3]=_n14;this.elements[4]=_n21,this.elements[5]=_n22,this.elements[6]=_n23,this.elements[7]=_n24;this.elements[8]=_n31,this.elements[9]=_n32,this.elements[10]=_n33,this.elements[11]=_n34;this.elements[12]=_n41,this.elements[13]=_n42,this.elements[14]=_n43,this.elements[15]=_n44}Matrix4.perspective=function(fov,aspect,nearZ,farZ){var cotHalfFoV=1/Math.tan(fov/2);return new Matrix4(cotHalfFoV/aspect,0,0,0,0,cotHalfFoV,0,0,0,0,-(farZ+nearZ)/(farZ-nearZ),-2*farZ*nearZ/(farZ-nearZ),0,0,-1,0)};Matrix4.prototype.transpose=function(){this.swapPosition(1,4);this.swapPosition(2,8);this.swapPosition(3,12);this.swapPosition(6,9);this.swapPosition(7,13);this.swapPosition(11,14)};Matrix4.prototype.copy=function(){return new Matrix4(this.elements[0],this.elements[1],this.elements[2],this.elements[3],this.elements[4],this.elements[5],this.elements[6],this.elements[7],this.elements[8],this.elements[9],this.elements[10],this.elements[11],this.elements[12],this.elements[13],this.elements[14],this.elements[15])};Matrix4.prototype.elementAt=function(i,j){return this.elements[i*4+j]};Matrix4.prototype.print=function(){console.log(this.elements[0],this.elements[1],this.elements[2],this.elements[3]);console.log(this.elements[4],this.elements[5],this.elements[6],this.elements[7]);console.log(this.elements[8],this.elements[9],this.elements[10],this.elements[11]);console.log(this.elements[12],this.elements[13],this.elements[14],this.elements[15])};Matrix4.prototype.mulVec4=function(v){var result=new Vec4;result.x=this.elements[0]*v.x+this.elements[1]*v.y+this.elements[2]*v.z+this.elements[3]*v.w;result.y=this.elements[4]*v.x+this.elements[5]*v.y+this.elements[6]*v.z+this.elements[7]*v.w;result.z=this.elements[8]*v.x+this.elements[9]*v.y+this.elements[10]*v.z+this.elements[11]*v.w;result.w=this.elements[12]*v.x+this.elements[13]*v.y+this.elements[14]*v.z+this.elements[15]*v.w;return result};Matrix4.prototype.mulMat4=function(mat4){var result=new Matrix4;for(var i=0;i<4;i++){for(var j=0;j<4;j++){var tmp=0;for(var t=0;t<4;t++){tmp+=this.elementAt(i,t)*mat4.elementAt(t,j)}result.elements[i*4+j]=tmp}}return result};Matrix4.prototype.swapPosition=function(i,j){var tmp=this.elements[i];this.elements[i]=this.elements[j];this.elements[j]=tmp};return Matrix4}();"use strict";var Vec3=function(){function Vec3(_x,_y,_z){if(_x===void 0){_x=0}if(_y===void 0){_y=0}if(_z===void 0){_z=0}this.x=_x;this.y=_y;this.z=_z}Vec3.prototype.set=function(_x,_y,_z){this.x=_x;this.y=_y;this.z=_z};Vec3.prototype.clone=function(){return new Vec3(this.x,this.y,this.z)};Vec3.prototype.swap=function(v){var tmp=v.clone();v.x=this.x;v.y=this.y;v.z=this.z;this.x=tmp.x;this.y=tmp.y;this.z=tmp.z};Vec3.prototype.interp=function(v,t){var x=interp(this.x,v.x,t);var y=interp(this.y,v.y,t);var z=interp(this.z,v.z,t);return new Vec3(x,y,z)};Vec3.prototype.add=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z};Vec3.prototype.addScalar=function(s){this.x+=s;this.y+=s;this.z+=s};return Vec3}();"use strict";var Vec4=function(){function Vec4(_x,_y,_z,_w){if(_x===void 0){_x=0}if(_y===void 0){_y=0}if(_z===void 0){_z=0}if(_w===void 0){_w=0}this.x=_x;this.y=_y;this.z=_z;this.w=_w}Vec4.prototype.set=function(_x,_y,_z,_w){if(_w===void 0){_w=0}this.x=_x;this.y=_y;this.z=_z;this.w=_w};Vec4.prototype.clone=function(){return new Vec4(this.x,this.y,this.z,this.w)};Vec4.prototype.add=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w};Vec4.prototype.addScalar=function(s){this.x+=s;this.y+=s;this.z+=s;this.w+=s};return Vec4}();"use strict";function interp(x1,x2,t){return x1+(x2-x1)*t}